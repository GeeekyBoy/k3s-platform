# K3s Platform - Application Configuration
# ==============================================================================
# This file is the single source of truth for all deployments.
#
# Environments:
#   - dev:   Local development with Tilt hot-reload
#   - local: On-premises production-like deployment (k3d + ArgoCD)
#   - gcp:   Cloud production deployment (GCP + ArgoCD)
#
# Deployment Types:
#   - helm:       Third-party Helm charts (databases, etc.)
#   - kustomize:  Your services deployed via k8s/overlays
#   - serverless: k3sfn functions with scale-to-zero
#   - apps:       Traditional container applications
#
# To add/remove services, just enable/disable entries below.
# No script or Tiltfile changes needed!
# ==============================================================================

# Helm Charts (third-party services)
helm:
  - name: valkey
    chart: bitnami/valkey
    version: "5.0.10"
    namespace: apps
    values: apps/valkey/values.yaml
    enabled: true

# Kustomize Deployments (your apps via k8s/base + overlays)
# The overlay is auto-selected based on environment (dev, local, gcp)
kustomize:
  - name: apps
    path: k8s/overlays/${PLATFORM_ENV}
    enabled: true

# Serverless Functions (k3sfn with @http, @queue, @schedule decorators)
# Functions are discovered automatically, built, and deployed with scale-to-zero
serverless:
  - name: serverless-example
    path: apps/serverless-example
    namespace: apps
    enabled: true
    dev:
      port_base: 8081
      live_update: true

# Traditional Container Apps (Dockerfile-based)
apps:
  - name: fastapi
    path: apps/fastapi
    namespace: apps
    enabled: true
    dockerfile: Dockerfile
    dockerfile_dev: Dockerfile.dev
    dev:
      port: 8000
      live_update: true
      sync:
        - src: src/
          dest: /app/src/

# Helm Repository URLs
repositories:
  bitnami: oci://registry-1.docker.io/bitnamicharts
  kedacore: https://kedacore.github.io/charts
